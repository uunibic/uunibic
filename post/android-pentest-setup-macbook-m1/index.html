<!doctype html>
<html lang="en-us"><head>
    <title>Mahesh Jandwani</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />

    <link rel="icon" href="https://maheshjandwani.tech/images/favicon.ico">

    
    
    
    <link rel="stylesheet" href="../../css/theme.min.css">

    
    
    

    
</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        
                            src="../../images/avatar.jpeg"
                        
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        Mahesh Jandwani
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    Security Engineer | Acko | Bangalore, KA
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../about/" title="About">About</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../post/" title="Posts">Posts</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../categories/" title="Categories">Categories</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../certificates/my-certificates/" title="Certificates">Certificates</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/uunibic" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://linkedin.com/in/maheshj5677" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://twitter.com/UN1B1C" target="_blank">
                            <i class="fab fa-twitter fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="mailto:maheshjhandwani9999@gmail.com" target="_blank">
                            <i class="fas fa-at fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-2">
        <div class="mb-3">
            <h3 class="mb-0">Android Pen-testing Environment Setup on M1 Mac</h3>
            
            <small class="text-muted">Published April 8, 2023</small>
        </div>

        <article>
            <p><img src="../../android.jpeg" alt="Setup - Android"></p>
<p>If you have got yourself a Mac to get better at hacking (of course ethically), then you might have already tried setting up an android penetration testing environment in your laptop. Definitely, I agree that this is a tough nut to crack. You might have faced several issues, whether it&rsquo;s about installing Genymotion or about SSL Pinning bypass. Don&rsquo;t worry we will cover all the steps to create a setup from scratch. If you&rsquo;re a beginner, this blog is for you. If you have already started setting up and are still facing issues, this blog is for you. You can catch up with the blog according to the scenario, which is why I have mentioned the blog content and requiements below:</p>
<style>
    .custom-details summary.dropdown-summary {
        font-size: 18px;
    }
</style>

<div>
    <details class="custom-details">
        <summary class="dropdown-summary"><strong>Table of Contents</strong></summary>
        <br>
        <nav>
            <ol>
<li><a href="#1-download--installation---android-studio">Download &amp; Installation - Android Studio</a></li>
<li><a href="#2-rooting-the-android-virtual-device-with-rootavd">Rooting the Android Virtual Device with rootAVD</a></li>
<li><a href="#3-configuring-burp-proxy-with-android-virtual-device">Configuring Burp Proxy with Android Virtual Device</a></li>
<li><a href="#4-importing-modules-and-configuring-frida-server">Importing Modules and Configuring Frida-Server</a></li>
<li><a href="#5-bonus-content---extra-frida-scripts--alternative-way">Bonus Content - Extra Frida Scripts &amp; Alternative Way</a></li>
</ol>

        </nav>
    </details>
</div>
<style>
  .custom-details summary.dropdown-summary {
    font-size: 18px;
  }
</style>

<details class="custom-details">
  <summary class="dropdown-summary"><strong>Requirements [Important]</strong></summary>
  <br>
  <ul>
<li><a href="https://developer.android.com/studio">Android Studio</a></li>
<li><a href="https://stackoverflow.com/questions/31374085/installing-adb-on-macos">Android Debug Bridge (adb)</a></li>
<li><a href="https://programwithus.com/learn/python/install-python3-mac">Python 3.x</a></li>
<li><a href="https://portswigger.net/burp/communitydownload">BurpSuite</a></li>
<li><a href="https://frida.re/docs/installation/">Frida</a></li>
<li><a href="https://www.javatpoint.com/install-git-on-mac">Git</a></li>
</ul>

</details>
<h4 id="1-download--installation---android-studio">1) Download &amp; Installation - Android Studio</h4>
<p>Yes, we will be using android studio and its emulator (QEMU) for creating an android virtual device (AVD) on which we will test and run our applications. To download the android studio, you can simply go to <a href="https://developer.android.com/studio">this</a> official link and fetch out the latest version.</p>
<p>At the time I am writing this blog, the latest version is <code>Android Studio Electric Eel | 2022.1.1 Patch 2</code>. Once the download is completed, install it in your device with the default configurations. It will also ask you to download some required packages, download them too. The whole task will take a couple of minutes to finish.</p>
<p>Now create a new project and follow the below mentioned steps to create an android virtual device:</p>
<ol>
<li>Click on <code>Create Device</code>.</li>
<li>Select a device with Google Play Store in it. <code>(eg: Pixel 4)</code></li>
<li>Click on next to download API Level 30 and remember to choose the correct ABI according to your laptop&rsquo;s architecture. <code>(eg: arm64/x86)</code></li>
<li>Once downloaded, select it and give your device a name like <code>Pixel_4_API_30</code>.</li>
<li>Now your AVD is ready to launch. So do it.</li>
</ol>
<p><img src="../../Installation-Android-Studio.png" alt="Setup - Android Stuido"></p>
<h4 id="2-rooting-the-android-virtual-device-with-rootavd">2) Rooting the Android Virtual Device with rootAVD</h4>
<p>I hope everything is executed well and fine till now, the AVD is also running properly in your machine. Lets proceed further to root our device with a script known as <code>rootAVD.sh</code>. You can find the github repository link below, just clone it anywhere on your device and enter into the <code>rootAVD/</code> directory.</p>
<p>Repo Link: <a href="https://github.com/newbit1/rootAVD">https://github.com/newbit1/rootAVD</a></p>
<p>Follow the Commands:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>1) git clone https://github.com/newbit1/rootAVD.git <span style="color:#960050;background-color:#1e0010">&amp;&amp;</span> cd rootAVD
</span></span><span style="display:flex;"><span>2) chmod +x rootAVD.sh
</span></span><span style="display:flex;"><span>3) ./rootAVD.sh ListAllAVDs
</span></span><span style="display:flex;"><span>4) ./rootAVD.sh ~/Library/Android/sdk/system-images/android-30/google_apis_playstore/arm64-v8a/ramdisk.img</span></span></code></pre></div></p>
<p><strong>Note:</strong> Remember to change the architecture in the command no. 4 (x86/arm64).</p>
<p>When the execution is completed, an application called <code>Magisk</code> will be installed on your android device. It means that your device is now successfully rooted. You can also follow the video for your reference:</p>
<div class="video-container">
    <video controls>
      <source src="../../videos/rootAVD_MacOS.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <style>
      .video-container {
        display: flex;
        justify-content: center;
        align-items: center;
        max-width: 100%;
        overflow: hidden;
      }
  
      .video-container video {
        width: 100%;
        height: auto;
        max-width: 600px;  
      }
    </style>
  </div>  
<h4 id="3-configuring-burp-proxy-with-android-virtual-device">3) Configuring Burp Proxy with Android Virtual Device</h4>
<p>Now let&rsquo;s configure the proxy with our virtual device to intercept the traffic between application and it&rsquo;s server. To do so, you first have to download <a href="https://portswigger.net/burp/communitydownload">BurpSuite</a>.</p>
<p>Install it with the default configurations and Go to:</p>
<p><code>Proxy Tab &gt;&gt; Proxy Settings &gt;&gt; Proxy Listeners &gt;&gt; Add</code></p>
<ol>
<li>Bind to port: <code>8085</code>.</li>
<li>Select <code>All Interfaces</code>.</li>
<li>Click <code>Ok</code> and <code>Yes</code>.</li>
</ol>
<p><img src="../../burp-proxy.png" alt="Setup - Burp Proxy"></p>
<p>Now once again Go to:</p>
<p><code>Proxy Tab &gt;&gt; Proxy Settings &gt;&gt; Import/Export CA certificate</code></p>
<ol>
<li>Select <code>Certificate in DER Format</code>.</li>
<li>Click <code>Next</code> and then <code>Select File</code>.</li>
<li>Select any folder and enter file name as <code>burp.cer</code>.</li>
<li>Click <code>Save</code> and then <code>Finish</code>.</li>
</ol>
<p>Once done, lets move the certificate file into mobile device:</p>
<ol>
<li>Open the folder where <code>burp.cer</code> is saved.</li>
<li>Using drag and drop, move the file into device&rsquo;s storage.</li>
<li>Go to mobile settings and open <code>Security</code> section.</li>
<li>Click on <code>Encryption &amp; Credentials</code> and then <code>Install a certificate</code>.</li>
<li>Select <code>CA Certificate</code>, choose <code>burp.cer</code> from storage and install it.</li>
</ol>
<p><img src="../../burp-cer.png" alt="Setup - Burp Certificate"></p>
<p><strong>Note:</strong> Now go to your android device&rsquo;s wifi settings and edit its configuration by adding the manual proxy. Enter your laptop&rsquo;s private IP address in the Proxy Hostname <code>(eg: 192.168.10.33)</code> and Proxy Port number as <code>8085</code>. Click Save and its done :)</p>
<h4 id="4-importing-modules-and-configuring-frida-server">4) Importing Modules and Configuring Frida-Server</h4>
<p>If you have finished the third step, it&rsquo;s now time to import few modules and setup the frida-server with your AVD and Mac. Download the below mentioned zip files from GitHub:</p>
<ul>
<li><a href="https://github.com/NVISOsecurity/MagiskTrustUserCerts/releases/download/v0.4.1/AlwaysTrustUserCerts.zip">AlwaysTrustUserCerts.zip</a></li>
<li><a href="https://github.com/ViRb3/magisk-frida/releases/download/16.0.11-1/MagiskFrida-16.0.11-1.zip">MagiskFrida-16.0.11-1.zip</a></li>
</ul>
<p>When the download gets completed, simply drag and drop both of them into the android device&rsquo;s storage aka <code>Download</code> folder. Now open Magisk App and click on <code>Modules</code> on the bottom right corner.</p>
<ol>
<li>Click on <code>Install from Storage</code>.</li>
<li>Select <code>AlwaysTrustUserCerts.zip</code> and reboot.</li>
<li>Again, repeat the same steps for <code>MagiskFrida-16.0.11-1.zip</code>.</li>
</ol>
<p>Once the above steps are completed and the device is rebooted successfully, download an application <code>(eg: Amazon)</code> from playstore and let it install. Now open the Magisk App again and click on the <code>Settings</code> icon on the top right corner.</p>
<ol>
<li>Enable <code>Zygisk</code> and <code>Enforce Deny List</code> mode.</li>
<li>Go to <code>Configure Denylist</code>.</li>
<li>Checkmark the app and its submodules for to bypass the root detection.</li>
</ol>
<p><img src="../../magisk-setup.png" alt="Setup - Magisk Modules"></p>
<p>Everything is set now and it&rsquo;s time to bypass SSL Pinning of the application. Copy and save <a href="https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/">this</a> frida script as <code>ssl_bypass.js</code>, open terminal and change your directory to where you saved it and run the below commands after that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>1) adb push ssl_bypass.js /data/local/tmp
</span></span><span style="display:flex;"><span>2) adb ls /data/local/tmp
</span></span><span style="display:flex;"><span>3) frida -U -f in.amazon.mShop.android.shopping -l ssl_bypass.js</span></span></code></pre></div>
<p><strong>Note:</strong> Remember to replace the application package name <code>in.amazon.mShop.android</code> with your application&rsquo;s package name. If you are having difficulty finding it, go to Magisk App and open the <code>Deny List</code>. You will find them for every installed application.</p>
<p>Running the above commands will cause the application to automatically open in your AVD, and then you can start intercepting traffic in BurpSuite.</p>
<p><img src="../../amazon-traffic.png" alt="Setup - Amazon Traffic"></p>
<h4 id="5-bonus-content---extra-frida-scripts--alternative-way">5) Bonus Content - Extra Frida Scripts &amp; Alternative Way</h4>
<p>Thats it, we have come a long way ðŸ˜Š !! You can now start your Android/Mobile pentesting journey peacefully. I know some of you might have queries and questions to clarify; don&rsquo;t worry, you can reach out to me on any of my social media handles and I will be glad to help you.</p>
<p>Though, below mentioned are the few things, which came to my mind and can help you a lot. There might be some applications for which the above frida script will not work, so you can try the below ones:</p>
<ul>
<li><a href="https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/">Universal Android SSL Pinning Bypass - By pcipolloni</a></li>
<li><a href="https://github.com/httptoolkit/frida-android-unpinning/blob/main/frida-script.js">Frida Android Unpinning - By httptoolkit</a></li>
<li><a href="https://codeshare.frida.re/@sowdust/universal-android-ssl-pinning-bypass-2/">Universal Android SSL Pinning Bypass 2 - By sowdust</a></li>
</ul>
<p>Also, if you are looking for an alternative method to set up your android pentest environment, you can study the below mentioned blog:</p>
<ul>
<li><a href="https://systemweakness.com/configuring-burp-proxy-with-android-emulator-in-macbook-m1-df2af37a8164">Configuring Burp Proxy with Android Emulator - By Pragya Gupta</a></li>
</ul>
<p>Thanks for checking out, I hope you find this blog useful and interesting. A big credit to my friends <a href="https://twitter.com/utkarshrai28">@Utkarsh_Rai</a> and <a href="https://twitter.com/iamnihal_">@Nihal_Choudhary</a> for helping me out, let&rsquo;s catch up in some other super cool blog, MJ :)</p>
<hr>

        </article>
    </div>

    

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; Copyright 2023, Mahesh Jandwani
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
    </small>
</footer>
</body>
</html>
